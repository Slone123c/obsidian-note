#计算机网络
# TCP 可靠传输的实现原理

## 可靠的定义
- 传输的数据没有差错
- 传输的数据不会丢失

## 如何保证可靠
- 传输出错的数据进行重新传输
- 控制传输速度，让接收方来得及处理

# 超时重传协议

在发送数据后的规定时间内，如果没有收到接收方的确认消息，则视为未收到，重新传输数据。

**重新传输数据的时间T应该怎么设定？**
A -> B 发送数据     ---- t1
B 处理消息          ---- t2
B -> A  发送确认消息 ---- t3

可以取t1, t2, t3 的平均值，T需要大于这个平均值

# 停止等待协议
在网络传输当中，如果发送方等待接收方发送确认消息才进行下一次传输，会导致效率大大降低，且只有单方通信。TCP协议是全双工通信，因此在AB双方都有一个缓冲区。所有的消息会被存放在缓冲区中。
## 缓冲区工作原理
**A -> B 发送消息**
1. 只要缓冲区不满，A就会持续发送消息。
2. 每当B从缓冲区中取出消息，处理完毕，就会发送确认消息给A，同时处理下一条消息。
3. 当A收到了B的确认消息，就会从缓冲区移除对应的消息。
4. 如此循环，直到所有消息发送完毕。

**没有缓冲区的停止等待协议相当于缓冲区大小为1的情况**

# 连续ARQ协议（滑动窗口）
![[Pasted image 20230618145823.png]]
![[Pasted image 20230618145826.png]]


# TCP三次握手与四次挥手

1. TCP 是全双工的，**如果只有两次握手，那么结果就是客户端发送、服务器确认，这只能保证服务器能接收到客户端的消息，而不能保证客户端能接收到服务器的消息，这是不可靠的**。所以我们需要三次握手，直到第三次客户端的应答过来了，才能保证客户端确确实实收到了服务器的确认信号，也就是保证了双方都能互相接收到对方的消息，也就保证了可靠性。
2. 还有一点，就是可以**避免浪费资源**。比如：第一次握手时由于网络问题，发出的信号迟迟没有到达服务器，于是，由于超时重传，客户端再次发送一个连接信号，此时，网络中有两个连接信号了；如果这时候网络突然好了，那么服务器就会一下收到两个连接信号，如果是两次握手，服务器此时就直接打开了两个连接。这两个连接中必定有一个是无用的，白白浪费资源。如果是三次握手呢？服务器就不会打开连接，而是发送两个确认信号给客户端，客户端收到第一个确认信号时，就告诉服务器打开连接（第三次握手），收到第二个确认信号时，由于已经收到过相同的信号了，就认为是重复的，就直接丢掉。这样服务器就只会收到一个第三次握手的信号，只会建立一个连接，从而避免浪费资源。

**保证可靠，避免浪费资源**。