# [现代化的命令行框架-Cobra全解](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fmarmotedu%2Fgeekbang-go%2Fblob%2Fmaster%2F%25E7%258E%25B0%25E4%25BB%25A3%25E5%258C%2596%25E7%259A%2584%25E5%2591%25BD%25E4%25BB%25A4%25E8%25A1%258C%25E6%25A1%2586%25E6%259E%25B6-Cobra%25E5%2585%25A8%25E8%25A7%25A3.md "https://github.com/marmotedu/geekbang-go/blob/master/%E7%8E%B0%E4%BB%A3%E5%8C%96%E7%9A%84%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A1%86%E6%9E%B6-Cobra%E5%85%A8%E8%A7%A3.md")
使用Cobra框架配合Viper对程序的应用配置文件进行加载。

# 如何选择配置读取功能

## 有哪些配置
- 命令行选项
- 命令行参数
- 配置文件

---
## 代码实现了什么功能
我们要实现的 Go 项目是一个 Web 服务，而非一个命令行工具，不需要考虑读取命令行参数这类场景，其需要的配置内容都可以通过命令行选项或者配置文件加载到程序中。所以，对于 miniblog，我们需要实现：**命令行选项、配置文件** 2 种配置读取方式。

---
## 为什么选择所有的配置都通过配置文件获取的方式

- **配置文件更易部署：** 我们可以将应用需要的所有配置，聚合在一个配置文件中，部署时，只需要部署、加载这个配置文件即可启动程序，不用配置一大堆命令行选项；
    
- **配置文件更易维护：** 我们可以将应用需要的所有配置都保存在配置文件中，加上详细的配置说明，不需要的配置可以注释掉。一个具有全量配置项、详细说明的配置文件，更易于理解。并且在修改时，只需要修改配置项的值，而不需要修改配置项名称，更不易出错；
    
- **配置文件可以实现热加载能力：** 应用程序监听配置文件的变更， 有变更时重新加载程序配置，可以实现配置热加载能力；
    
- **配置层次表达更清晰：** 命令行参数无法直接表达“层次”，但配置文件可以。层次化的配置表达，更易于理解。因为具有“层次”，所以配置文件也可以表达更复杂的配置内容；
    
- **新增一个配置项方便：** 新增一个配置项，多数情况下只需要在配置文件中，加一行配置即可，不需要修改源码。

### 命令行读取配置的优势
- **零成本获知应用程序的配置项：** 只需要执行 `miniblog -h` 就能够知道 `miniblog` 有哪些配置项，以及配置项的说明和默认值；
    
- **可快速启动程序：** 如果应用程序配置项比较少，可以不用编写配置文件，仅通过指定命令行选项即可快速启动程序，例如：`miniapp -addr=:8080`；
    
- **维护成本低：** 不需要维护额外的配置文件（仅限于参数很少的情况下）；
    
- **可以设置默认值：** 通过给命令行选项，设置默认值，可以在程序启动时，只设置需要关心的命令行选项即可启动程序（实际上，在中大型的应用程序中，很多默认值是无法直接使用的，例如：存储相关配置）；
    
- **可以与 bash 脚本很好的交互：** 例如变量替换、变量引用等，例如 `miniapp -addr=${ADDR}`。

### **结论**
配置项少的时候（例如：5 个以内），可以从命令行选项中读取。参数较多的时候适合从配置文件读取。考虑到一个应用程序，即使刚开始配置项较少，随着不断的迭代，配置项可能越来越多，使用命令行选项来配置会越来越复杂。**这里建议，如果是一个企业级应用，建议一开始就使用配置文件来配置你的应用程序。**

---
