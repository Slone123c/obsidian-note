# 为什么要制定业务错误码?
- 用户在调用 API 接口后，服务端会返回错误信息，但错误信息是可变的，用户很难根据可变的错误信息，进行针对性的逻辑判断。例如，如果发现授权失败就告警；
    
- 用户调用 API 接口，后端返回如下错误：`request is invalid`。用户很难根据这个宽泛的错误内容，判断出错误的原因；
    
- 后端服务，经常会返回某种类别的错误，针对这种类别的错误，有一些解决方案。当我提供一个解决方案的时候，如何唯一定位到一个错误类型呢？

**引入错误码有如下好处：**

- 开发者可以非常方便地定位问题和定位代码行（看到错误码就知道什么意思，grep 错误码可以定位到错误码所在行）；
- 客户可以根据错误信息，知道接口失败的原因，并可以提供错误码，给开发人员定位排障；
- 错误码包含一定的信息，通过错误码可以判断出错误级别、错误模块和具体错误信息；
- 业务开发过程中，可能需要判断错误是哪种类型，以便做相应的逻辑处理，通过定制的错误码很容易做到这点，例如：

# 制定错误码规范
错误码，是直接暴露给用户看的，这就需要我们设计一个易读、易懂、规范化的错误码。那么如何设计错误码呢？你可以根据需要自己设计，也可以参考其他优秀的设计。

通常，当你调研一种技术实现时，你可以优先参考各大公有云厂商的实现方式，例如：腾讯云、阿里云、华为云等。因为公有云厂商，直接面向企业/个人，专注于技术本身，并且具有非常强的技术团队，所以这些厂商的设计和实现，是非常值得我们参考的。

经过调研，这里我采用了腾讯云 API 3.0 的错误码设计规范。并将规范文档保存在项目的文档中：[docs/devel/zh-CN/conversions/error_code.md](https://link.juejin.cn/?target=https%3A%2F%2Fgithub.com%2Fmarmotedu%2Fminiblog%2Fblob%2Fmaster%2Fdocs%2Fdevel%2Fzh-CN%2Fconversions%2Ferror_code.md "https://github.com/marmotedu/miniblog/blob/master/docs/devel/zh-CN/conversions/error_code.md")。

# 开发流程
- 开发自定义错误包
	- API 请求返回报错时，需要返回：HTTP Status Code（HTTP 状态码）、Code（业务错误码）、Message（可直接暴露给用户的错误信息），所以我们首先定义一个 `Errno` 结构体用来保存这些信息：
- 开发通用返回接口
	- 上面我们开发了错误码相关功能。这时候还需要开发一个统一的返回方法，通过调用同一个返回方法，可以确保我们的返回信息格式是统一的。